{% extends "base.html" %}

{% block title %}Admin Panel{% endblock %}

{% block header %}Admin Panel{% endblock %}

{% block content %}
    <a href="{{ url_for('logs') }}" class="btn btn-secondary mb-3">View Logs</a>
    <a href="{{ url_for('user_logout') }}" class="btn btn-danger mb-3 float-end">Logout</a>

    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" id="users-tab" data-target="users-section">Manage Users</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="tools-tab" data-target="tools-section">Manage Tools</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="settings-tab" data-target="settings-section">Admin Settings</a>
        </li>
    </ul>

    <!-- Users Section -->
    <div id="users-section" class="mt-4 section">
        <h2>Existing Users</h2>
        <input type="text" id="searchUsers" class="form-control mb-2" placeholder="Search users...">
        <div class="card">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>RFID Tag</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTable">
                    {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.name }}</td>
                        <td>{{ user.rfid_tag }}</td>
                        <td>{{ user.role }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('delete_user_route') }}">
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <h2 class="mt-4">Add User</h2>
        <form method="POST" action="{{ url_for('add_user_route') }}">
            <label>User Name:</label>
            <input type="text" name="name" class="form-control" required>

            <label>RFID Tag:</label>
            <input type="text" name="rfid_tag" class="form-control" required>

            <label>Role:</label>
            <select name="role" class="form-control">
                <option value="admin">Admin</option>
                <option value="manager">Manager</option>
                <option value="user" selected>User</option>
                <option value="viewer">Viewer</option>
            </select>

            <button type="submit" class="btn btn-success mt-3">Add User</button>
        </form>
    </div>

    <!-- Tools Section -->
    <div id="tools-section" class="mt-4 section" style="display: none;">
        <h2>Existing Tools</h2>
        <input type="text" id="searchTools" class="form-control mb-2" placeholder="Search tools...">
        <div class="card">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tool Name</th>
                        <th>Barcode</th>
                        <th>Quantity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="toolsTable">
                    {% for tool in tools %}
                    <tr>
                        <td>{{ tool.id }}</td>
                        <td>{{ tool.name }}</td>
                        <td>{{ tool.barcode }}</td>
                        <td>{{ tool.quantity }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('delete_tool_route') }}">
                                <input type="hidden" name="tool_id" value="{{ tool.id }}">
                                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Admin Settings Section -->
    <div id="settings-section" class="mt-4 section" style="display: none;">
        <h2>Admin Settings</h2>
        <form method="POST" action="{{ url_for('update_logout_time_route') }}">
            <label>Set Auto-Logout Time (seconds):</label>
            <input type="number" name="logout_time" class="form-control" value="{{ logout_time }}" required>
            <button type="submit" class="btn btn-info mt-2">Update Logout Time</button>
        </form>
    </div>

{% endblock %}
